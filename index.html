<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIST CSF 2.0 Audit Tool Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .screen { display: none; }
        .screen.active { display: block; }
        .progress-bar { transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); width: var(--progress-width, 0%); }
        /* Đổi màu chủ đạo sang Xanh Dương (Blue) đặc trưng của NIST để phân biệt với tool ISO (Xanh lá) */
        #sectionList button.active { background-color: #2563eb; color: white; font-weight: 600; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        #evidenceList::-webkit-scrollbar { width: 6px; }
        #evidenceList::-webkit-scrollbar-thumb { background-color: #bfdbfe; border-radius: 999px; }
        #evidenceList::-webkit-scrollbar-thumb:hover { background-color: #3b82f6; }
        .btn-hover-effect:hover { transform: translateY(-1px); }
        .btn-hover-effect:active { transform: translateY(0px); }
        /* Custom màu cho file upload NIST */
        input[type="file"]::file-selector-button { margin-right: 1rem; padding: 0.5rem 1rem; border-radius: 9999px; border: 0; font-size: 0.875rem; font-weight: 600; background-color: #eff6ff; color: #1d4ed8; cursor: pointer; transition: background-color 0.2s; }
        input[type="file"]::file-selector-button:hover { background-color: #dbeafe; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="screen-setup" class="screen active max-w-2xl mx-auto p-10 bg-white shadow-2xl rounded-2xl mt-20 border border-blue-100">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-slate-800 tracking-tight">NIST CSF 2.0 <span class="text-blue-600">Master Audit</span></h1>
            <p class="text-slate-500 mt-2 text-lg">Công cụ đánh giá An ninh mạng theo khung NIST 2.0 mới nhất.</p>
        </div>
        <div class="space-y-6">
            <div>
                <label for="clientName" class="block text-sm font-bold text-slate-700 mb-2 uppercase">Tên Khách hàng / Tổ chức</label>
                <input type="text" id="clientName" class="block w-full p-4 border-2 border-slate-200 rounded-xl text-lg focus:border-blue-500 focus:outline-none transition-colors" placeholder="Ví dụ: Ngân hàng ABC, Fintech XYZ...">
            </div>
            <button id="startButton" class="btn-hover-effect w-full bg-blue-600 text-white py-4 rounded-xl text-xl font-bold hover:bg-blue-700 transition shadow-lg">
                Bắt đầu Đánh giá NIST
            </button>
        </div>
    </div>

    <div id="screen-audit" class="screen max-w-[95rem] mx-auto p-6 mt-6">
        <div class="flex flex-col lg:flex-row gap-8 h-[calc(100vh-6rem)]">
            <nav class="w-full lg:w-1/4 xl:w-1/5 bg-white shadow-xl rounded-2xl overflow-hidden border border-slate-200 flex flex-col">
                <div class="p-5 bg-slate-50 border-b border-slate-200">
                    <h2 class="text-lg font-extrabold text-blue-700 uppercase">Chức năng (Functions)</h2>
                </div>
                <div class="flex-1 overflow-y-auto p-3"><ul id="sectionList" class="space-y-1.5"></ul></div>
            </nav>

            <div class="flex-1 flex flex-col gap-6 overflow-hidden">
                <div class="bg-white p-6 shadow-md rounded-2xl border border-slate-200 flex-shrink-0">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <div class="text-sm font-semibold text-slate-400 uppercase">Đang đánh giá</div>
                            <h1 class="text-3xl font-bold text-slate-800 truncate" id="clientNameDisplay"></h1>
                        </div>
                         <button id="saveReportButton" class="btn-hover-effect bg-slate-800 text-white py-3 px-6 rounded-xl font-bold hover:bg-slate-900 transition shadow-md flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            Xuất Báo cáo NIST
                        </button>
                    </div>
                    <div class="bg-slate-100 p-4 rounded-xl">
                        <div class="flex justify-between text-sm font-bold text-slate-600 mb-2">
                            <span>Tiến độ hoàn thành</span><span id="progressText" class="text-blue-700">0/0</span>
                        </div>
                        <div class="w-full bg-slate-300 rounded-full h-4 overflow-hidden">
                            <div id="progressBar" class="progress-bar bg-gradient-to-r from-blue-600 to-blue-400 h-full rounded-full"></div>
                        </div>
                    </div>
                </div>

                <div class="flex-1 bg-white p-8 shadow-xl rounded-2xl border border-slate-200 overflow-y-auto flex flex-col">
                    <div class="flex-1">
                         <div class="mb-8">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="px-4 py-1.5 bg-blue-100 text-blue-800 text-xs font-bold uppercase rounded-full" id="controlSection"></span>
                                <span class="font-mono text-sm text-slate-500 bg-slate-100 px-2 py-1 rounded-md border" id="controlId"></span>
                            </div>
                            <h2 class="text-2xl md:text-3xl font-bold text-slate-800 leading-tight" id="controlQuestion"></h2>
                             <div id="explanationArea" class="mt-5">
                                <details class="group border border-slate-200 rounded-xl overflow-hidden transition-all open:bg-blue-50/50">
                                    <summary class="flex cursor-pointer items-center justify-between p-3 bg-slate-50 hover:bg-slate-100 transition">
                                        <span class="text-sm font-semibold text-blue-700 flex items-center">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                            Hướng dẫn & Gợi ý bằng chứng (NIST)
                                        </span>
                                        <span class="transition group-open:rotate-180"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></span>
                                    </summary>
                                    <div id="explanationContent" class="p-5 text-sm text-slate-700 leading-relaxed border-t border-slate-200"></div>
                                </details>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
                            <div class="xl:col-span-5 space-y-8">
                                <div>
                                    <label class="block text-sm font-bold text-slate-700 mb-3 uppercase">Mức độ Đáp ứng (Tier)</label>
                                     <select id="controlStatus" class="block w-full p-3.5 border-2 border-slate-300 rounded-xl focus:border-blue-500 bg-white font-medium shadow-sm">
                                        <option value="Bỏ qua" class="text-slate-400">(Chưa đánh giá)</option>
                                        <option value="Đáp ứng hoàn toàn" class="text-blue-600 font-bold">✓ Đáp ứng hoàn toàn (Implemented)</option>
                                        <option value="Đáp ứng một phần" class="text-amber-600 font-bold">⚠ Đáp ứng một phần (Partial)</option>
                                        <option value="Chưa đáp ứng" class="text-red-600 font-bold">✕ Chưa đáp ứng (Not Implemented)</option>
                                        <option value="Không áp dụng" class="text-slate-600 font-bold">○ Không áp dụng (N/A)</option>
                                    </select>
                                </div>
                                <div>
                                     <div class="flex justify-between items-center mb-3">
                                        <label class="block text-sm font-bold text-slate-700 uppercase">Bằng chứng (Files)</label>
                                        <span class="text-xs bg-slate-100 px-2 py-1 rounded-md">Đa tập tin</span>
                                    </div>
                                    <label class="flex flex-col items-center justify-center w-full h-36 border-2 border-slate-300 border-dashed rounded-xl cursor-pointer hover:bg-blue-50 hover:border-blue-400 transition relative">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-10 h-10 mb-3 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                                            <p class="text-sm text-slate-500 font-medium"><span class="text-blue-600 underline">Click tải lên</span> hoặc kéo thả file</p>
                                            <p class="text-xs text-slate-400">(Giữ Ctrl/Shift chọn nhiều file)</p>
                                        </div>
                                        <input id="controlEvidenceUpload" type="file" class="hidden" multiple />
                                        <div id="uploadLoading" class="absolute inset-0 bg-white/80 hidden flex flex-col items-center justify-center">
                                             <span class="text-sm font-bold text-blue-700 animate-pulse">Đang tải lên cloud...</span>
                                        </div>
                                    </label>
                                    <div id="evidenceList" class="mt-4 space-y-2 max-h-[200px] overflow-y-auto pr-1"></div>
                                </div>
                            </div>
                            <div class="xl:col-span-7">
                                <label class="block text-sm font-bold text-slate-700 mb-3 uppercase">Ghi chú / Hiện trạng thực tế</label>
                                <textarea id="controlNote" rows="12" class="block w-full p-5 border-2 border-slate-300 rounded-xl focus:border-blue-500 text-base resize-none bg-slate-50 focus:bg-white transition leading-relaxed" placeholder="Mô tả hiện trạng thực tế tại tổ chức, các lỗ hổng (Gaps) hoặc kế hoạch cải thiện..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-between items-center pt-6 mt-8 border-t border-slate-100">
                        <button id="prevButton" class="btn-hover-effect flex items-center px-6 py-3 bg-white border-2 border-slate-200 text-slate-700 rounded-xl font-bold hover:bg-slate-50 transition disabled:opacity-50">Câu trước</button>
                        <div class="text-xl font-black text-slate-300 select-none tracking-widest" id="controlCounter">1 / 100</div>
                        <button id="nextButton" class="btn-hover-effect flex items-center px-8 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">Tiếp theo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="screen-done" class="screen max-w-3xl mx-auto p-12 bg-white shadow-2xl rounded-3xl mt-24 text-center border border-slate-100">
        <h1 class="text-4xl font-extrabold text-blue-700 mb-4">Đánh giá Hoàn tất!</h1>
        <p class="text-slate-500 mb-10 text-xl">Báo cáo NIST CSF 2.0 đã được tạo thành công.</p>
        <div class="bg-slate-50 p-6 rounded-2xl mb-10 border-2 border-slate-100 inline-block mx-auto">
             <div class="flex items-center justify-center text-slate-700 font-medium">
                <span id="reportFileName" class="text-lg break-all"></span>
             </div>
        </div>
        <button id="restartButton" class="btn-hover-effect w-full md:w-2/3 mx-auto block bg-slate-800 text-white py-4 px-8 rounded-2xl text-xl font-bold hover:bg-slate-900 transition shadow-lg">Bắt đầu phiên mới</button>
    </div>

<script>
// --- DATABASE NIST CSF 2.0 (Vietnamese) ---
const CHECKLIST_DATA = [
  // ========================================================================
  // 1. GOVERN (GV - QUẢN TRỊ) - 31 Subcategories
  // ========================================================================
  // --- GV.OC: Bối cảnh Tổ chức (Organizational Context) ---
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OC-01",
    "question": "Sứ mệnh, tầm nhìn và các mục tiêu chiến lược của tổ chức có được thấu hiểu và sử dụng để định hướng các quyết định về an ninh mạng không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo an ninh mạng phục vụ mục tiêu kinh doanh.<br><b>Bằng chứng:</b> Tài liệu chiến lược công ty; Biên bản họp BLĐ về định hướng ANTT."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OC-02",
    "question": "Các bên liên quan nội bộ và bên ngoài có được xác định và thấu hiểu nhu cầu, kỳ vọng của họ về an ninh mạng không?",
    "explanation": "<b>Ý nghĩa:</b> Biết rõ ai đang kỳ vọng gì để đáp ứng.<br><b>Bằng chứng:</b> Danh sách các bên liên quan (Stakeholder Register); Khảo sát nhu cầu ANTT."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OC-03",
    "question": "Các yêu cầu pháp lý, quy định và nghĩa vụ hợp đồng liên quan đến an ninh mạng có được xác định và quản lý không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh rủi ro pháp lý.<br><b>Bằng chứng:</b> Danh mục văn bản pháp quy (Luật ANM, NĐ13...); Báo cáo đánh giá tuân thủ."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OC-04",
    "question": "Các tài sản quan trọng và quy trình nghiệp vụ then chốt tạo ra giá trị cho tổ chức có được xác định rõ ràng không?",
    "explanation": "<b>Ý nghĩa:</b> Xác định 'Crown Jewels' để ưu tiên bảo vệ.<br><b>Bằng chứng:</b> Báo cáo BIA; Danh sách tài sản quan trọng."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OC-05",
    "question": "Kết quả, năng lực và hiệu quả của chiến lược an ninh mạng hiện tại có được sử dụng để điều chỉnh chiến lược tương lai không?",
    "explanation": "<b>Ý nghĩa:</b> Học từ quá khứ để cải tiến tương lai.<br><b>Bằng chứng:</b> Báo cáo tổng kết chiến lược ANTT; Quyết định điều chỉnh chiến lược."
  },

  // --- GV.RM: Chiến lược Quản lý Rủi ro (Risk Management Strategy) ---
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-01",
    "question": "Khẩu vị rủi ro (Risk Appetite) và mức độ chấp nhận rủi ro có được xác định và truyền thông rõ ràng không?",
    "explanation": "<b>Ý nghĩa:</b> Lãnh đạo chấp nhận mức độ rủi ro nào.<br><b>Bằng chứng:</b> Tuyên bố khẩu vị rủi ro (Risk Appetite Statement)."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-02",
    "question": "Các chiến lược quản lý rủi ro (chấp nhận, tránh, giảm thiểu, chuyển giao) có được thiết lập và thống nhất không?",
    "explanation": "<b>Ý nghĩa:</b> Khung hướng dẫn chung để xử lý rủi ro.<br><b>Bằng chứng:</b> Chính sách quản lý rủi ro; Khung ERM."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-03",
    "question": "Các mô hình và phương pháp đánh giá rủi ro an ninh mạng có được xác định và áp dụng nhất quán không?",
    "explanation": "<b>Ý nghĩa:</b> Thống nhất 'thước đo' rủi ro.<br><b>Bằng chứng:</b> Quy trình đánh giá rủi ro chuẩn (ISO 27005, NIST SP 800-30)."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-04",
    "question": "Rủi ro an ninh mạng có được xem xét trong bối cảnh rủi ro chung của toàn doanh nghiệp không?",
    "explanation": "<b>Ý nghĩa:</b> Tích hợp rủi ro IT vào rủi ro doanh nghiệp.<br><b>Bằng chứng:</b> Báo cáo rủi ro tích hợp (Integrated Risk Report)."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-05",
    "question": "Việc chia sẻ thông tin rủi ro nội bộ và bên ngoài có được thực hiện để nâng cao nhận thức không?",
    "explanation": "<b>Ý nghĩa:</b> Chia sẻ để cùng phòng tránh.<br><b>Bằng chứng:</b> Bản tin an ninh nội bộ; Tham gia các diễn đàn chia sẻ (ISAC)."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-06",
    "question": "Rủi ro từ việc sử dụng công nghệ thông tin có được xác định và quản lý không?",
    "explanation": "<b>Ý nghĩa:</b> Đánh giá rủi ro trước khi áp dụng công nghệ mới.<br><b>Bằng chứng:</b> Đánh giá rủi ro dự án CNTT."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RM-07",
    "question": "Các phương án chuyển giao rủi ro (ví dụ: bảo hiểm an ninh mạng) có được sử dụng không?",
    "explanation": "<b>Ý nghĩa:</b> Giảm gánh nặng tài chính khi có sự cố.<br><b>Bằng chứng:</b> Hợp đồng bảo hiểm Cyber."
  },

  // --- GV.RR: Vai trò, Trách nhiệm và Quyền hạn ---
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RR-01",
    "question": "Lãnh đạo cao nhất có cam kết, định hướng và chịu trách nhiệm giải trình về chiến lược an ninh mạng không?",
    "explanation": "<b>Ý nghĩa:</b> Cam kết từ cấp cao nhất.<br><b>Bằng chứng:</b> Tuyên bố cam kết của lãnh đạo; Phân công C-level phụ trách."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RR-02",
    "question": "Các vai trò và trách nhiệm an ninh mạng có được xác định, mô tả và truyền thông rõ ràng không?",
    "explanation": "<b>Ý nghĩa:</b> Rõ người rõ việc.<br><b>Bằng chứng:</b> Sơ đồ tổ chức ANTT; JD; RACI matrix."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RR-03",
    "question": "Nguồn lực (nhân sự, ngân sách, công nghệ) có được phân bổ đầy đủ để thực hiện chiến lược an ninh mạng không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo đủ nguồn lực.<br><b>Bằng chứng:</b> Ngân sách ANTT được phê duyệt."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.RR-04",
    "question": "Văn hóa an ninh mạng có được xây dựng và thúc đẩy trong toàn tổ chức không?",
    "explanation": "<b>Ý nghĩa:</b> Biến bảo mật thành trách nhiệm chung.<br><b>Bằng chứng:</b> Chương trình văn hóa doanh nghiệp lồng ghép ANTT."
  },

  // --- GV.PO: Chính sách (Policy) ---
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.PO-01",
    "question": "Các chính sách an ninh mạng có được thiết lập, phê duyệt và ban hành không?",
    "explanation": "<b>Ý nghĩa:</b> Thiết lập 'luật chơi' rõ ràng.<br><b>Bằng chứng:</b> Hệ thống tài liệu chính sách (ISMS) đã ban hành."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.PO-02",
    "question": "Chính sách an ninh mạng có được truyền thông đến đúng đối tượng liên quan không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo nhân viên biết luật.<br><b>Bằng chứng:</b> Log gửi email chính sách; Cổng thông tin nội bộ."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.PO-03",
    "question": "Chính sách an ninh mạng có được rà soát và cập nhật định kỳ không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo chính sách luôn phù hợp.<br><b>Bằng chứng:</b> Lịch sử phiên bản tài liệu; Kế hoạch rà soát hàng năm."
  },

  // --- GV.OV: Giám sát (Oversight) ---
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OV-01",
    "question": "Kết quả thực hiện chiến lược an ninh mạng có được giám sát và đo lường thông qua các chỉ số (KPI/KRI) không?",
    "explanation": "<b>Ý nghĩa:</b> Đo lường để quản lý hiệu quả.<br><b>Bằng chứng:</b> Dashboard báo cáo KPI/Metrics ANTT."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OV-02",
    "question": "Việc tuân thủ chính sách và quy định có được kiểm tra định kỳ (audit nội bộ/bên ngoài) không?",
    "explanation": "<b>Ý nghĩa:</b> Tin tưởng nhưng cần kiểm chứng.<br><b>Bằng chứng:</b> Báo cáo kiểm toán nội bộ; Chứng chỉ ISO/SOC2."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.OV-03",
    "question": "Kết quả giám sát và kiểm tra có được sử dụng để điều chỉnh chiến lược và cải thiện không?",
    "explanation": "<b>Ý nghĩa:</b> Phát hiện sai sót để khắc phục.<br><b>Bằng chứng:</b> Kế hoạch hành động khắc phục (CAP)."
  },

  // --- GV.SC: Quản lý Chuỗi cung ứng (Supply Chain) ---
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-01",
    "question": "Quy trình quản lý rủi ro chuỗi cung ứng có được thiết lập, bao gồm việc xác định, đánh giá và giám sát NCC không?",
    "explanation": "<b>Ý nghĩa:</b> Quản lý tổng thể rủi ro từ đối tác.<br><b>Bằng chứng:</b> Chính sách quản lý nhà cung cấp."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-02",
    "question": "Các yêu cầu an ninh mạng có được xác định và đưa vào hợp đồng với các nhà cung cấp không?",
    "explanation": "<b>Ý nghĩa:</b> Ràng buộc trách nhiệm pháp lý.<br><b>Bằng chứng:</b> Điều khoản bảo mật trong Hợp đồng/NDA."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-03",
    "question": "Các nhà cung cấp có được đánh giá năng lực an ninh mạng trước khi hợp tác không?",
    "explanation": "<b>Ý nghĩa:</b> Thẩm định kỹ càng trước khi hợp tác.<br><b>Bằng chứng:</b> Phiếu thẩm định (Due Diligence Checklist)."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-04",
    "question": "Rủi ro từ các nhà cung cấp có được giám sát và đánh giá lại định kỳ không?",
    "explanation": "<b>Ý nghĩa:</b> Giám sát liên tục vì đối tác có thể yếu đi.<br><b>Bằng chứng:</b> Báo cáo đánh giá định kỳ NCC."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-05",
    "question": "Kế hoạch ứng phó sự cố có bao gồm các kịch bản liên quan đến nhà cung cấp không?",
    "explanation": "<b>Ý nghĩa:</b> Sẵn sàng ứng phó khi đối tác gặp sự cố.<br><b>Bằng chứng:</b> Playbook ứng phó sự cố chuỗi cung ứng."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-06",
    "question": "Quy trình kết thúc hợp tác (Off-boarding) có đảm bảo thu hồi quyền truy cập và xử lý dữ liệu an toàn không?",
    "explanation": "<b>Ý nghĩa:</b> Kết thúc hợp tác an toàn.<br><b>Bằng chứng:</b> Checklist thanh lý hợp đồng; Biên bản xóa dữ liệu."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-07",
    "question": "Tổ chức có yêu cầu các nhà cung cấp cấp 1 phải quản lý rủi ro an ninh mạng đối với các nhà cung cấp lại của họ không?",
    "explanation": "<b>Ý nghĩa:</b> Quản lý rủi ro xuyên suốt chuỗi cung ứng.<br><b>Bằng chứng:</b> Điều khoản hợp đồng yêu cầu quản lý thầu phụ."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-08",
    "question": "Tổ chức có tham gia vào các hoạt động chia sẻ thông tin rủi ro chuỗi cung ứng với cộng đồng không?",
    "explanation": "<b>Ý nghĩa:</b> Học hỏi từ cộng đồng về vendor rủi ro.<br><b>Bằng chứng:</b> Tham gia các diễn đàn ISAC."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-09",
    "question": "Tổ chức có các phương án dự phòng cho trường hợp nhà cung cấp quan trọng gặp sự cố không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh phụ thuộc hoàn toàn vào một NCC.<br><b>Bằng chứng:</b> Kế hoạch BCP với kịch bản thay thế NCC."
  },
  {
    "section": "GV - QUẢN TRỊ",
    "id": "GV.SC-10",
    "question": "Quy trình phát triển phần mềm an toàn (SSDLC) có được áp dụng cho phần mềm tự phát triển hoặc thuê ngoài không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo mật từ khâu thiết kế.<br><b>Bằng chứng:</b> Quy trình SSDLC; Báo cáo test SAST/DAST."
  },

  // ========================================================================
  // 2. IDENTIFY (ID - NHẬN DIỆN) - 22 Subcategories
  // ========================================================================
  // --- ID.AM: Quản lý Tài sản (Asset Management) ---
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-01",
    "question": "Danh mục kiểm kê các thiết bị vật lý (phần cứng) có được thiết lập, duy trì và cập nhật không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát tài sản phần cứng.<br><b>Bằng chứng:</b> Hardware Asset Inventory."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-02",
    "question": "Danh mục kiểm kê phần mềm, hệ điều hành và ứng dụng có được thiết lập không?",
    "explanation": "<b>Ý nghĩa:</b> Quản lý license, phiên bản phần mềm.<br><b>Bằng chứng:</b> Software Asset Inventory."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-03",
    "question": "Các tài sản có được phân loại dựa trên mức độ quan trọng (Criticality) đối với tổ chức không?",
    "explanation": "<b>Ý nghĩa:</b> Ưu tiên bảo vệ tài sản quan trọng.<br><b>Bằng chứng:</b> Phân loại tài sản (High/Medium/Low)."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-04",
    "question": "Các dịch vụ bên ngoài (SaaS, PaaS, IaaS) có được kiểm kê và quản lý không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát tài sản trên Cloud.<br><b>Bằng chứng:</b> Danh sách dịch vụ Cloud đang sử dụng."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-05",
    "question": "Các tài sản dữ liệu có được xác định, phân loại và định vị (biết nó nằm ở đâu) không?",
    "explanation": "<b>Ý nghĩa:</b> Biết dữ liệu nhạy cảm ở đâu để bảo vệ.<br><b>Bằng chứng:</b> Data Map; Danh mục tài sản thông tin."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-07",
    "question": "Vòng đời của tài sản (từ mua sắm đến hủy bỏ) có được quản lý theo quy trình không?",
    "explanation": "<b>Ý nghĩa:</b> Quản lý tài sản suốt vòng đời.<br><b>Bằng chứng:</b> Quy trình quản lý vòng đời tài sản."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.AM-08",
    "question": "Các luồng dữ liệu (Data Flow) và quy trình xử lý dữ liệu quan trọng có được xác định và lập tài liệu (ví dụ: vẽ sơ đồ) không?",
    "explanation": "<b>Ý nghĩa:</b> Hiểu rõ đường đi của dữ liệu.<br><b>Bằng chứng:</b> Sơ đồ DFD (Data Flow Diagram)."
  },

  // --- ID.RA: Đánh giá Rủi ro (Risk Assessment) ---
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-01",
    "question": "Các lỗ hổng bảo mật trên tài sản có được xác định, xác thực và ghi nhận không?",
    "explanation": "<b>Ý nghĩa:</b> Chủ động tìm điểm yếu.<br><b>Bằng chứng:</b> Báo cáo quét lỗ hổng (Vulnerability Scan)."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-02",
    "question": "Thông tin tình báo mối đe dọa (Threat Intel) có được thu thập và phân tích không?",
    "explanation": "<b>Ý nghĩa:</b> Nắm bắt xu hướng tấn công mới.<br><b>Bằng chứng:</b> Bản tin Threat Intel; Feed IOCs."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-03",
    "question": "Các mối đe dọa từ nội bộ và bên ngoài có được xác định và lập danh mục không?",
    "explanation": "<b>Ý nghĩa:</b> Biết rõ kẻ thù tiềm năng.<br><b>Bằng chứng:</b> Danh mục mối đe dọa (Threat Catalogue)."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-04",
    "question": "Tác động tiềm ẩn và khả năng xảy ra của các rủi ro có được phân tích không?",
    "explanation": "<b>Ý nghĩa:</b> Tính toán mức độ nghiêm trọng của rủi ro.<br><b>Bằng chứng:</b> Ma trận đánh giá rủi ro."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-05",
    "question": "Rủi ro có được sắp xếp ưu tiên dựa trên mức độ ảnh hưởng đến tổ chức không?",
    "explanation": "<b>Ý nghĩa:</b> Ưu tiên xử lý rủi ro lớn nhất.<br><b>Bằng chứng:</b> Danh sách ưu tiên rủi ro."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-06",
    "question": "Các phương án xử lý rủi ro (Risk Responses) có được xác định và lựa chọn không?",
    "explanation": "<b>Ý nghĩa:</b> Quyết định phương án xử lý rủi ro.<br><b>Bằng chứng:</b> Kế hoạch xử lý rủi ro (RTP)."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-07",
    "question": "Các thay đổi về rủi ro có được theo dõi và cập nhật liên tục vào hồ sơ rủi ro không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo hồ sơ rủi ro luôn cập nhật.<br><b>Bằng chứng:</b> Risk Register cập nhật thường xuyên."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.RA-08",
    "question": "Các giả định và giới hạn của việc đánh giá rủi ro có được xác định rõ không?",
    "explanation": "<b>Ý nghĩa:</b> Hiểu rõ phạm vi và độ tin cậy của đánh giá.<br><b>Bằng chứng:</b> Mục 'Giả định' trong báo cáo rủi ro."
  },

  // --- ID.IM: Cải tiến (Improvement) ---
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.IM-01",
    "question": "Các kế hoạch cải tiến an ninh mạng (ví dụ: sau audit, sau sự cố) có được thiết lập và theo dõi tiến độ không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo khắc phục các vấn đề đã tìm thấy.<br><b>Bằng chứng:</b> Kế hoạch hành động khắc phục (CAP)."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.IM-02",
    "question": "Bài học kinh nghiệm từ sự cố thực tế có được dùng để cải tiến quy trình không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh lặp lại sai lầm cũ.<br><b>Bằng chứng:</b> Báo cáo rút kinh nghiệm (Lessons Learned)."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.IM-03",
    "question": "Quy trình quản lý vòng đời hệ thống (SDLC) có tích hợp yêu cầu bảo mật ngay từ đầu không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo mật từ thiết kế (Security by Design).<br><b>Bằng chứng:</b> Tài liệu yêu cầu bảo mật dự án."
  },
  {
    "section": "ID - NHẬN DIỆN",
    "id": "ID.IM-04",
    "question": "Tổ chức có định kỳ đánh giá lại hiệu quả của các biện pháp kiểm soát hiện tại không?",
    "explanation": "<b>Ý nghĩa:</b> Tối ưu hóa công cụ/quy trình đang sử dụng.<br><b>Bằng chứng:</b> Báo cáo đánh giá hiệu quả công nghệ."
  },

  // ========================================================================
  // 3. PROTECT (PR - BẢO VỆ) - 28 Subcategories
  // ========================================================================
  // --- PR.AA: Kiểm soát Truy cập & Xác thực ---
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-01",
    "question": "Danh tính và thông tin xác thực người dùng có được quản lý tập trung và bảo vệ không?",
    "explanation": "<b>Ý nghĩa:</b> Quản lý danh tính người dùng hiệu quả.<br><b>Bằng chứng:</b> Hệ thống IAM/AD; Chính sách mật khẩu."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-02",
    "question": "Truy cập vật lý vào các khu vực nhạy cảm có được kiểm soát và giám sát không?",
    "explanation": "<b>Ý nghĩa:</b> Ngăn chặn tiếp cận vật lý trái phép.<br><b>Bằng chứng:</b> Log cửa từ, camera DC."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-03",
    "question": "Truy cập từ xa (Remote Access) có được quản lý chặt chẽ và bảo vệ (VPN, MFA) không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo mật làm việc từ xa.<br><b>Bằng chứng:</b> Cấu hình VPN; Log truy cập từ xa."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-04",
    "question": "Quyền truy cập có tuân theo nguyên tắc đặc quyền tối thiểu và phân tách nhiệm vụ không?",
    "explanation": "<b>Ý nghĩa:</b> Cấp quyền vừa đủ.<br><b>Bằng chứng:</b> Ma trận phân quyền (Access Matrix)."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-05",
    "question": "Quyền truy cập có được rà soát định kỳ và thu hồi ngay khi không cần thiết không?",
    "explanation": "<b>Ý nghĩa:</b> Loại bỏ tài khoản thừa.<br><b>Bằng chứng:</b> Biên bản rà soát quyền (Access Review)."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-06",
    "question": "Xác thực đa yếu tố (MFA) có được áp dụng cho các truy cập quan trọng không?",
    "explanation": "<b>Ý nghĩa:</b> Tăng cường bảo mật xác thực.<br><b>Bằng chứng:</b> Cấu hình MFA."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-07",
    "question": "Người dùng có được xác minh danh tính kỹ càng trước khi cấp quyền truy cập không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo cấp quyền đúng người.<br><b>Bằng chứng:</b> Quy trình onboarding nhân sự."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AA-08",
    "question": "Phiên làm việc (Session) của người dùng có được quản lý an toàn (timeout, logout) không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh bị chiếm phiên làm việc.<br><b>Bằng chứng:</b> Cấu hình Session Timeout."
  },

  // --- PR.AT: Nhận thức và Đào tạo ---
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AT-01",
    "question": "Tất cả nhân viên có được đào tạo nhận thức an ninh mạng định kỳ không?",
    "explanation": "<b>Ý nghĩa:</b> Nâng cao nhận thức bảo mật chung.<br><b>Bằng chứng:</b> Hồ sơ đào tạo; Kết quả test."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AT-02",
    "question": "Nhân sự có vai trò đặc biệt có được đào tạo chuyên sâu phù hợp không?",
    "explanation": "<b>Ý nghĩa:</b> Đào tạo chuyên sâu cho vị trí rủi ro cao.<br><b>Bằng chứng:</b> Chứng chỉ đào tạo chuyên môn."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AT-03",
    "question": "Lãnh đạo cấp cao có được cập nhật thông tin về rủi ro an ninh mạng không?",
    "explanation": "<b>Ý nghĩa:</b> Giúp lãnh đạo hiểu để ra quyết định.<br><b>Bằng chứng:</b> Nội dung briefing cho lãnh đạo."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AT-04",
    "question": "Bên thứ ba (nhà thầu, đối tác) có được yêu cầu đào tạo nhận thức an ninh mạng không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo đối tác có nhận thức bảo mật.<br><b>Bằng chứng:</b> Yêu cầu đào tạo trong hợp đồng."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.AT-05",
    "question": "Hiệu quả của chương trình đào tạo có được đánh giá (ví dụ: qua diễn tập Phishing) không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm tra hiệu quả đào tạo.<br><b>Bằng chứng:</b> Kết quả Phishing Test."
  },

  // --- PR.DS: An ninh Dữ liệu ---
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.DS-01",
    "question": "Dữ liệu lưu trữ (Data-at-rest) có được bảo vệ (ví dụ: mã hóa) không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ dữ liệu khi lưu trữ.<br><b>Bằng chứng:</b> Cấu hình Bitlocker, TDE."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.DS-02",
    "question": "Dữ liệu truyền tải (Data-in-transit) có được bảo vệ (ví dụ: mã hóa TLS/VPN) không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ dữ liệu khi truyền tải.<br><b>Bằng chứng:</b> Cấu hình HTTPS, VPN."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.DS-09",
    "question": "Tài sản dữ liệu có được quản lý trong suốt vòng đời (tạo, dùng, lưu, hủy) không?",
    "explanation": "<b>Ý nghĩa:</b> Quản lý vòng đời dữ liệu.<br><b>Bằng chứng:</b> Quy trình hủy dữ liệu an toàn."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.DS-10",
    "question": "Tính toàn vẹn của dữ liệu có được đảm bảo (ví dụ: dùng hash, chữ ký số) không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo dữ liệu không bị sửa đổi trái phép.<br><b>Bằng chứng:</b> Sử dụng FIM (File Integrity Monitoring)."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.DS-11",
    "question": "Dữ liệu có được sao lưu (Backup) và kiểm tra phục hồi định kỳ không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo khả năng khôi phục dữ liệu.<br><b>Bằng chứng:</b> Log backup; Biên bản test restore."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.DS-12",
    "question": "Các biện pháp chống rò rỉ dữ liệu (DLP) có được triển khai không?",
    "explanation": "<b>Ý nghĩa:</b> Ngăn chặn rò rỉ dữ liệu nhạy cảm.<br><b>Bằng chứng:</b> Cấu hình hệ thống DLP."
  },

  // --- PR.PS: An ninh Nền tảng ---
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.PS-01",
    "question": "Cấu hình an toàn (Hardening) có được thiết lập và áp dụng cho các hệ thống không?",
    "explanation": "<b>Ý nghĩa:</b> Áp dụng cấu hình bảo mật chuẩn.<br><b>Bằng chứng:</b> Hardening checklist; Kết quả scan cấu hình."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.PS-02",
    "question": "Phần mềm cài đặt trên hệ thống có được kiểm soát (ví dụ: Whitelisting) không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát phần mềm được phép chạy.<br><b>Bằng chứng:</b> Cấu hình AppLocker."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.PS-03",
    "question": "Quản lý bản vá (Patching) có được thực hiện kịp thời và tự động hóa không?",
    "explanation": "<b>Ý nghĩa:</b> Vá lỗ hổng bảo mật kịp thời.<br><b>Bằng chứng:</b> Báo cáo tình trạng bản vá."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.PS-04",
    "question": "Nhật ký hệ thống (Logs) có được ghi lại đầy đủ và bảo vệ tập trung không?",
    "explanation": "<b>Ý nghĩa:</b> Ghi log phục vụ điều tra, giám sát.<br><b>Bằng chứng:</b> Hệ thống Log tập trung (SIEM)."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.PS-05",
    "question": "Các thiết bị lưu trữ di động (USB) có được kiểm soát chặt chẽ không?",
    "explanation": "<b>Ý nghĩa:</b> Ngăn chặn nguy cơ từ thiết bị ngoại vi.<br><b>Bằng chứng:</b> Chính sách chặn USB."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.PS-06",
    "question": "Việc thay đổi cấu hình hệ thống có được quản lý theo quy trình (Change Management) không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát thay đổi hệ thống.<br><b>Bằng chứng:</b> Ticket Change Request (CR)."
  },

  // --- PR.IR: Khả năng phục hồi hạ tầng ---
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.IR-01",
    "question": "Mạng lưới có được phân đoạn (Network Segmentation) để cô lập các vùng quan trọng không?",
    "explanation": "<b>Ý nghĩa:</b> Ngăn chặn tấn công lan rộng.<br><b>Bằng chứng:</b> Sơ đồ VLAN/Zone; Firewall rules."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.IR-02",
    "question": "Các cơ chế dự phòng (HA) có được triển khai cho các hệ thống quan trọng không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo tính sẵn sàng của hệ thống.<br><b>Bằng chứng:</b> Cấu hình Cluster, Load Balancing."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.IR-03",
    "question": "Khả năng chịu tải và hiệu năng của hệ thống có được giám sát và quản lý không?",
    "explanation": "<b>Ý nghĩa:</b> Tránh quá tải hệ thống.<br><b>Bằng chứng:</b> Báo cáo Capacity Planning."
  },
  {
    "section": "PR - BẢO VỆ",
    "id": "PR.IR-04",
    "question": "Hạ tầng vật lý (điện, lạnh, PCCC) hỗ trợ hệ thống có được đảm bảo dự phòng không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo môi trường hoạt động ổn định.<br><b>Bằng chứng:</b> Hợp đồng bảo trì UPS, máy phát điện."
  },

  // ========================================================================
  // 4. DETECT (DE - PHÁT HIỆN) - 11 Subcategories
  // ========================================================================
  // --- DE.CM: Giám sát Liên tục ---
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.CM-01",
    "question": "Mạng lưới và môi trường vật lý có được giám sát liên tục 24/7 để phát hiện sự kiện an ninh không?",
    "explanation": "<b>Ý nghĩa:</b> Giám sát liên tục để phát hiện sớm.<br><b>Bằng chứng:</b> Màn hình SOC; Hợp đồng MSSP 24/7."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.CM-02",
    "question": "Môi trường vật lý có được giám sát để phát hiện truy cập trái phép không?",
    "explanation": "<b>Ý nghĩa:</b> Phát hiện đột nhập vật lý.<br><b>Bằng chứng:</b> Log camera, hệ thống báo động."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.CM-03",
    "question": "Hoạt động của nhân sự và các tài khoản có được giám sát để phát hiện hành vi bất thường không?",
    "explanation": "<b>Ý nghĩa:</b> Phát hiện hành vi người dùng đáng ngờ.<br><b>Bằng chứng:</b> Cảnh báo UEBA trên SIEM."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.CM-06",
    "question": "Các dịch vụ giám sát an ninh bên ngoài (ví dụ: MSSP) có được sử dụng để bổ sung năng lực không?",
    "explanation": "<b>Ý nghĩa:</b> Bổ sung năng lực giám sát chuyên sâu.<br><b>Bằng chứng:</b> Hợp đồng dịch vụ SOC/MSSP."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.CM-09",
    "question": "Hệ thống giám sát có khả năng phát hiện mã độc và các cuộc tấn công mạng phổ biến không?",
    "explanation": "<b>Ý nghĩa:</b> Năng lực phát hiện cơ bản.<br><b>Bằng chứng:</b> Cảnh báo từ Antivirus, IDS/IPS, WAF."
  },

  // --- DE.AE: Phân tích Sự kiện ---
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.AE-02",
    "question": "Các sự kiện từ nhiều nguồn có được phân tích tương quan (Correlation) để xác định sự cố không?",
    "explanation": "<b>Ý nghĩa:</b> Phân tích tương quan để phát hiện sự cố phức tạp.<br><b>Bằng chứng:</b> Correlation Rules trên SIEM."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.AE-03",
    "question": "Thông tin Threat Intel có được tích hợp tự động vào hệ thống giám sát không?",
    "explanation": "<b>Ý nghĩa:</b> Sử dụng Threat Intel để nâng cao khả năng phát hiện.<br><b>Bằng chứng:</b> Tích hợp TI feed vào SIEM."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.AE-04",
    "question": "Đường cơ sở (Baseline) hoạt động bình thường có được thiết lập để phát hiện bất thường không?",
    "explanation": "<b>Ý nghĩa:</b> Phát hiện bất thường dựa trên baseline.<br><b>Bằng chứng:</b> Tài liệu Baseline hoạt động hệ thống."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.AE-06",
    "question": "Các hoạt động săn tìm mối đe dọa (Threat Hunting) chủ động có được thực hiện định kỳ không?",
    "explanation": "<b>Ý nghĩa:</b> Chủ động tìm kiếm mối đe dọa ẩn mình.<br><b>Bằng chứng:</b> Báo cáo Threat Hunting."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.AE-07",
    "question": "Dữ liệu sự kiện có được tổng hợp và chuẩn hóa từ nhiều nguồn để phục vụ phân tích không?",
    "explanation": "<b>Ý nghĩa:</b> Chuẩn hóa log để dễ dàng phân tích.<br><b>Bằng chứng:</b> Hệ thống Log Management tập trung."
  },
  {
    "section": "DE - PHÁT HIỆN",
    "id": "DE.AE-08",
    "question": "Các cảnh báo an ninh có được phân loại và ưu tiên xử lý (Triage) không?",
    "explanation": "<b>Ý nghĩa:</b> Ưu tiên xử lý cảnh báo quan trọng.<br><b>Bằng chứng:</b> Quy trình Triage cảnh báo."
  },

  // ========================================================================
  // 5. RESPOND (RS - ỨNG PHÓ) - 13 Subcategories
  // ========================================================================
  // --- RS.MA: Quản lý Sự cố ---
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MA-01",
    "question": "Kế hoạch ứng phó sự cố (IRP) có được thiết lập, phê duyệt và duy trì cập nhật không?",
    "explanation": "<b>Ý nghĩa:</b> Sẵn sàng kế hoạch ứng phó.<br><b>Bằng chứng:</b> Tài liệu IRP."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MA-02",
    "question": "Quy trình báo cáo sự cố có được quy định rõ ràng và áp dụng cho toàn thể nhân viên không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo thông báo sự cố kịp thời.<br><b>Bằng chứng:</b> Sơ đồ Call Tree; Kênh báo cáo sự cố."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MA-03",
    "question": "Đội ứng phó sự cố (CSIRT) có được thành lập với vai trò rõ ràng và được đào tạo không?",
    "explanation": "<b>Ý nghĩa:</b> Có đội ngũ chuyên trách ứng phó.<br><b>Bằng chứng:</b> Quyết định thành lập CSIRT."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MA-04",
    "question": "Các công cụ và tài nguyên cần thiết cho việc ứng phó sự cố có luôn sẵn sàng không?",
    "explanation": "<b>Ý nghĩa:</b> Sẵn sàng công cụ ứng cứu.<br><b>Bằng chứng:</b> Danh sách IR Toolkit."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MA-05",
    "question": "Các tiêu chí để phân loại mức độ nghiêm trọng của sự cố có được thiết lập rõ ràng không?",
    "explanation": "<b>Ý nghĩa:</b> Phân loại mức độ sự cố để xử lý phù hợp.<br><b>Bằng chứng:</b> Bảng phân cấp sự cố."
  },

  // --- RS.AN: Phân tích Sự cố ---
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.AN-03",
    "question": "Các sự cố có được phân tích để xác định nguyên nhân gốc rễ và phạm vi ảnh hưởng không?",
    "explanation": "<b>Ý nghĩa:</b> Hiểu rõ nguyên nhân và tác động của sự cố.<br><b>Bằng chứng:</b> Báo cáo điều tra sự cố."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.AN-06",
    "question": "Các hành động trong quá trình xử lý sự cố có được ghi nhật ký đầy đủ không?",
    "explanation": "<b>Ý nghĩa:</b> Ghi lại diễn biến xử lý sự cố.<br><b>Bằng chứng:</b> Nhật ký sự cố (Incident Timeline)."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.AN-07",
    "question": "Bằng chứng số liên quan đến sự cố có được thu thập và bảo quản đúng quy trình pháp lý không?",
    "explanation": "<b>Ý nghĩa:</b> Bảo vệ tính pháp lý của bằng chứng.<br><b>Bằng chứng:</b> Biên bản Chain of Custody."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.AN-08",
    "question": "Các sự cố có được phân loại theo danh mục chung để phục vụ thống kê và báo cáo không?",
    "explanation": "<b>Ý nghĩa:</b> Thống kê, phân tích xu hướng sự cố.<br><b>Bằng chứng:</b> Danh mục phân loại sự cố."
  },

  // --- RS.MI: Giảm thiểu Sự cố ---
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MI-01",
    "question": "Các biện pháp ngăn chặn và diệt trừ có được thực hiện kịp thời để ngăn sự cố lan rộng không?",
    "explanation": "<b>Ý nghĩa:</b> Cô lập và loại bỏ mối đe dọa.<br><b>Bằng chứng:</b> Log ngăn chặn trên Firewall/EDR."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.MI-02",
    "question": "Các lỗ hổng mới phát hiện từ sự cố có được khắc phục ngay lập tức không?",
    "explanation": "<b>Ý nghĩa:</b> Khắc phục ngay lỗ hổng vừa bị khai thác.<br><b>Bằng chứng:</b> Ticket vá lỗi khẩn cấp."
  },

  // --- RS.CO: Truyền thông Sự cố ---
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.CO-02",
    "question": "Việc thông báo sự cố cho các bên liên quan có được thực hiện đúng quy định không?",
    "explanation": "<b>Ý nghĩa:</b> Thông báo sự cố đúng quy trình.<br><b>Bằng chứng:</b> Mẫu thông báo sự cố."
  },
  {
    "section": "RS - ỨNG PHÓ",
    "id": "RS.CO-03",
    "question": "Thông tin chia sẻ về sự cố ra bên ngoài có được kiểm soát nội dung chặt chẽ không?",
    "explanation": "<b>Ý nghĩa:</b> Kiểm soát phát ngôn về sự cố.<br><b>Bằng chứng:</b> Quy trình phát ngôn."
  },

  // ========================================================================
  // 6. RECOVER (RC - PHỤC HỒI) - 5 Subcategories
  // ========================================================================
  // --- RC.RP: Lập kế hoạch Phục hồi ---
  {
    "section": "RC - PHỤC HỒI",
    "id": "RC.RP-01",
    "question": "Kế hoạch phục hồi (Recovery Plan) có được thiết lập và sẵn sàng kích hoạt khi cần không?",
    "explanation": "<b>Ý nghĩa:</b> Sẵn sàng kế hoạch khôi phục hoạt động.<br><b>Bằng chứng:</b> Tài liệu DRP/BCP."
  },
  {
    "section": "RC - PHỤC HỒI",
    "id": "RC.RP-02",
    "question": "Thứ tự ưu tiên phục hồi cho các hệ thống quan trọng có được xác định rõ ràng không?",
    "explanation": "<b>Ý nghĩa:</b> Ưu tiên phục hồi hệ thống quan trọng trước.<br><b>Bằng chứng:</b> Danh sách ưu tiên phục hồi (RTO/RPO)."
  },
  {
    "section": "RC - PHỤC HỒI",
    "id": "RC.RP-03",
    "question": "Các bản sao lưu và cơ sở hạ tầng dự phòng có được sử dụng hiệu quả để phục hồi hoạt động không?",
    "explanation": "<b>Ý nghĩa:</b> Sử dụng backup/DR site để phục hồi.<br><b>Bằng chứng:</b> Biên bản kích hoạt DRP."
  },
  {
    "section": "RC - PHỤC HỒI",
    "id": "RC.RP-04",
    "question": "Hệ thống sau phục hồi có được kiểm tra, xác nhận an toàn trước khi đưa vào vận hành lại không?",
    "explanation": "<b>Ý nghĩa:</b> Đảm bảo hệ thống sạch trước khi chạy lại.<br><b>Bằng chứng:</b> Checklist kiểm tra sau phục hồi."
  },
  {
    "section": "RC - PHỤC HỒI",
    "id": "RC.RP-05",
    "question": "Các bài học kinh nghiệm từ quá trình phục hồi có được ghi nhận để cải tiến kế hoạch không?",
    "explanation": "<b>Ý nghĩa:</b> Rút kinh nghiệm để phục hồi tốt hơn lần sau.<br><b>Bằng chứng:</b> Báo cáo rút kinh nghiệm phục hồi."
  },

  // --- RC.CO: Truyền thông Phục hồi ---
  {
    "section": "RC - PHỤC HỒI",
    "id": "RC.CO-03",
    "question": "Các hoạt động truyền thông phục hồi uy tín và thương hiệu sau sự cố có được thực hiện không?",
    "explanation": "<b>Ý nghĩa:</b> Khôi phục niềm tin sau sự cố.<br><b>Bằng chứng:</b> Chiến dịch truyền thông phục hồi thương hiệu."
  }
];
let currentQuestionIndex = 0, clientName = "", auditResults = [], isDirty = false, sections = [];
const els = {
    clientNameInput: document.getElementById('clientName'), startButton: document.getElementById('startButton'),
    clientNameDisplay: document.getElementById('clientNameDisplay'), saveReportButton: document.getElementById('saveReportButton'),
    sectionList: document.getElementById('sectionList'), progressText: document.getElementById('progressText'),
    progressBar: document.getElementById('progressBar'), controlSection: document.getElementById('controlSection'),
    controlId: document.getElementById('controlId'), controlQuestion: document.getElementById('controlQuestion'),
    controlStatus: document.getElementById('controlStatus'), controlEvidenceUpload: document.getElementById('controlEvidenceUpload'),
    evidenceList: document.getElementById('evidenceList'), uploadLoading: document.getElementById('uploadLoading'),
    controlNote: document.getElementById('controlNote'), prevButton: document.getElementById('prevButton'),
    nextButton: document.getElementById('nextButton'), controlCounter: document.getElementById('controlCounter'), reportFileName: document.getElementById('reportFileName')
};
const screens = { setup: document.getElementById('screen-setup'), audit: document.getElementById('screen-audit'), done: document.getElementById('screen-done') };

window.addEventListener('beforeunload', (e) => { if (isDirty) { e.preventDefault(); e.returnValue = ''; } });
function showScreen(sid) { Object.values(screens).forEach(s => s.classList.remove('active')); screens[sid].classList.add('active'); }
function populateSidebar() {
    sections = [...new Set(CHECKLIST_DATA.map(item => item.section))]; els.sectionList.innerHTML = '';
    sections.forEach(sec => {
        const li = document.createElement('li'), btn = document.createElement('button');
        btn.className = "w-full text-left p-3 rounded-lg font-medium text-slate-600 hover:bg-blue-50 hover:text-blue-700 transition duration-150";
        btn.textContent = sec; btn.onclick = () => jumpToSection(sec); li.appendChild(btn); els.sectionList.appendChild(li);
    });
}
function updateSidebarHighlight(curr) { els.sectionList.querySelectorAll('button').forEach(b => b.classList.toggle('active', b.textContent === curr)); }
function jumpToSection(name) { saveCurrentAnswer(); currentQuestionIndex = CHECKLIST_DATA.findIndex(i => i.section === name); loadQuestion(currentQuestionIndex); updateProgress(); }
function startAudit() {
    clientName = els.clientNameInput.value.trim(); if (clientName === "") return alert("Vui lòng nhập tên khách hàng.");
    els.clientNameDisplay.textContent = clientName;
    auditResults = CHECKLIST_DATA.map(item => ({ ...item, status: "Bỏ qua", note: "", evidence_files: [] }));
    populateSidebar(); currentQuestionIndex = 0; loadQuestion(0); updateProgress(); showScreen('audit'); isDirty = true;
}
function renderEvidenceList() {
    const files = auditResults[currentQuestionIndex].evidence_files || []; els.evidenceList.innerHTML = '';
    if (files.length === 0) { els.evidenceList.innerHTML = '<div class="text-sm text-slate-400 italic pl-2">Chưa có file bằng chứng.</div>'; return; }
    files.forEach((url, index) => {
        const div = document.createElement('div'); div.className = 'flex items-center justify-between p-2.5 bg-blue-50 rounded-lg border border-blue-100 group hover:border-blue-300 transition';
        div.innerHTML = `<a href="${url}" target="_blank" class="text-sm text-blue-700 hover:underline truncate flex-1 mr-3 font-medium" title="${url.split('/').pop()}">📄 ${url.split('/').pop()}</a><button type="button" class="text-slate-400 hover:text-red-500 focus:outline-none p-1.5 rounded-full hover:bg-red-50 transition" title="Xóa file này" onclick="removeEvidenceFile(${index})"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></button>`;
        els.evidenceList.appendChild(div);
    });
}
window.removeEvidenceFile = function(fileIndex) { if (confirm('Bạn chắc chắn muốn xóa file này?')) { auditResults[currentQuestionIndex].evidence_files.splice(fileIndex, 1); renderEvidenceList(); }};
function loadQuestion(idx) {
    const item = CHECKLIST_DATA[idx], res = auditResults[idx];
    els.controlSection.textContent = item.section; els.controlId.textContent = item.id; els.controlQuestion.textContent = item.question; els.controlStatus.value = res.status;
    renderEvidenceList(); els.controlEvidenceUpload.value = null; els.controlNote.value = res.note; els.controlCounter.textContent = `${idx + 1} / ${CHECKLIST_DATA.length}`;
    updateSidebarHighlight(item.section);
    els.prevButton.disabled = (idx === 0); els.prevButton.classList.toggle('opacity-50', idx === 0); els.prevButton.classList.toggle('cursor-not-allowed', idx === 0);
    const isLast = idx === CHECKLIST_DATA.length - 1;
    els.nextButton.innerHTML = isLast ? `Hoàn thành <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>` : `Tiếp theo <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>`;
    els.nextButton.classList.toggle('bg-blue-800', isLast); els.nextButton.classList.toggle('hover:bg-blue-900', isLast);
    els.nextButton.classList.toggle('bg-blue-600', !isLast); els.nextButton.classList.toggle('hover:bg-blue-700', !isLast);
    const expArea = document.getElementById('explanationArea'), expContent = document.getElementById('explanationContent');
    if (expArea.querySelector('details')) expArea.querySelector('details').removeAttribute('open');
    if (item.explanation) { expArea.classList.remove('hidden'); expContent.innerHTML = item.explanation; } else { expArea.classList.add('hidden'); }
}
async function handleFileUpload(e) {
    const files = e.target.files; if (!files || files.length === 0) return;
    els.uploadLoading.classList.remove('hidden');
    const safeName = clientName ? clientName.trim().replace(/[^a-z0-9]/gi, '-').toLowerCase() : 'unknown';
    for (let i = 0; i < files.length; i++) {
        const formData = new FormData(); formData.append('file', files[i]);
        try {
            const res = await fetch('/api/upload', { method: 'POST', headers: { 'x-client-name': safeName }, body: formData });
            if (!res.ok) throw new Error((await res.json()).error || 'Upload thất bại.');
            const data = await res.json(); auditResults[currentQuestionIndex].evidence_files.push(data.url);
        } catch (err) { console.error(err); alert(`Lỗi khi tải file ${files[i].name}: ${err.message}`); }
    }
    els.uploadLoading.classList.add('hidden'); renderEvidenceList(); e.target.value = null;
}
function saveCurrentAnswer() { if(auditResults[currentQuestionIndex]) { auditResults[currentQuestionIndex].status = els.controlStatus.value; auditResults[currentQuestionIndex].note = els.controlNote.value.trim(); } }
function nextQuestion() { saveCurrentAnswer(); if (currentQuestionIndex < CHECKLIST_DATA.length - 1) { currentQuestionIndex++; loadQuestion(currentQuestionIndex); } else { generateReport(); } updateProgress(); }
function prevQuestion() { saveCurrentAnswer(); if (currentQuestionIndex > 0) { currentQuestionIndex--; loadQuestion(currentQuestionIndex); } updateProgress(); }
function updateProgress() { const answered = auditResults.filter(r => r.status !== "Bỏ qua").length; els.progressText.textContent = `${answered}/${CHECKLIST_DATA.length}`; els.progressBar.style.setProperty('--progress-width', `${(answered / CHECKLIST_DATA.length) * 100}%`); }

function generateReport() {
    try {
        if (!confirm("Bạn có chắc chắn muốn hoàn thành và xuất báo cáo NIST CSF không?")) return;
        saveCurrentAnswer(); updateProgress();
        const total = CHECKLIST_DATA.length, audited = auditResults.filter(r => r.status !== "Bỏ qua").length, compliant = auditResults.filter(r => r.status === "Đáp ứng hoàn toàn").length, partial = auditResults.filter(r => r.status === "Đáp ứng một phần").length, notimpl = auditResults.filter(r => r.status === "Chưa đáp ứng").length, na = auditResults.filter(r => r.status === "Không áp dụng").length, denom = audited - na;
        // Tính điểm NIST: (Đáp ứng hoàn toàn * 1 + Đáp ứng một phần * 0.5) / Tổng số áp dụng
        const score = denom > 0 ? Math.round(((compliant * 1 + partial * 0.5) / denom) * 100) : 0;
        let evalText = "", evalColor = ""; if (score >= 90) { evalText = "Hệ thống đang ở Tier 4 (Adaptive) - Rất tốt."; evalColor = "text-blue-600"; } else if (score >= 70) { evalText = "Hệ thống đang ở Tier 3 (Repeatable) - Khá."; evalColor = "text-emerald-600"; } else if (score >= 40) { evalText = "Hệ thống đang ở Tier 2 (Risk Informed) - Trung bình."; evalColor = "text-amber-600"; } else { evalText = "Hệ thống đang ở Tier 1 (Partial) - Cần cải thiện gấp."; evalColor = "text-red-600"; }
        const sectionStats = {}; auditResults.forEach(r => { if (!sectionStats[r.section]) sectionStats[r.section] = { score: 0, count: 0 }; if (r.status !== "Bỏ qua" && r.status !== "Không áp dụng") { sectionStats[r.section].count++; if (r.status === "Đáp ứng hoàn toàn") sectionStats[r.section].score += 1; if (r.status === "Đáp ứng một phần") sectionStats[r.section].score += 0.5; } });
        const chartLabels = Object.keys(sectionStats), chartData = chartLabels.map(s => sectionStats[s].count > 0 ? Math.round((sectionStats[s].score / sectionStats[s].count) * 100) : 0);
        const now = new Date(), reportDate = `${now.getDate()}/${now.getMonth()+1}/${now.getFullYear()}`, safeName = clientName.replace(/[^a-z0-9]/gi, '_').toLowerCase();
        
        const reportHTML = `<!DOCTYPE html><html lang="vi"><head><meta charset="UTF-8"><title>Báo cáo NIST CSF 2.0 - ${clientName}</title><script src="https://cdn.tailwindcss.com"><\/script><script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script><style>@media print{@page{size:A4 landscape;margin:10mm}body{margin:0;padding:0;background:white}.container{width:100%!important;max-width:none!important;box-shadow:none!important;margin:0!important;padding:0!important}.no-print{display:none!important}.page-break{page-break-before:always}h2,h3,.bg-slate-50,tr{break-inside:avoid}canvas{max-width:100%!important;max-height:100%!important}}body{font-family:'Inter',sans-serif;background:#f8fafc}.container{max-width:1000px;margin:0 auto;background:white;padding:40px;box-shadow:0 10px 30px -10px rgba(0,0,0,.1)}</style></head><body class="p-0 md:p-10"><div class="container mx-auto my-10 rounded-xl" id="report-container"><div class="flex justify-between items-center border-b-2 border-slate-800 pb-6 mb-8"><div><h1 class="text-4xl font-extrabold text-slate-800 uppercase">Báo cáo Đánh giá</h1><div class="text-xl font-semibold text-blue-600 mt-1">NIST CSF 2.0</div></div><div class="text-right"><div class="text-slate-500 font-medium">Tổ chức được đánh giá</div><div class="text-2xl font-bold text-slate-800">${clientName}</div><div class="text-slate-400 text-sm mt-1">Ngày: ${reportDate}</div></div></div><div class="bg-slate-50 rounded-2xl p-8 mb-10 border border-slate-200"><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center"><span class="bg-blue-600 w-2 h-8 mr-3 rounded-full"></span>1. Tóm tắt Tổng quan (Executive Summary)</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="flex flex-col items-center justify-center p-6 bg-white rounded-xl shadow-sm border border-slate-100"><div class="relative w-40 h-40"><svg class="w-full h-full" viewBox="0 0 36 36"><path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="#e2e8f0" stroke-width="3"/><path d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" fill="none" stroke="${score >= 70 ? '#2563eb' : (score >= 40 ? '#d97706' : '#dc2626')}" stroke-width="3" stroke-dasharray="${score}, 100"/><text x="18" y="20.5" font-size="8" font-weight="bold" text-anchor="middle" dominant-baseline="central" fill="${score >= 70 ? '#2563eb' : (score >= 40 ? '#d97706' : '#dc2626')}">${score}%</text></svg></div><div class="mt-4 text-lg font-bold text-slate-700">Điểm Maturity</div></div><div class="md:col-span-2 flex flex-col justify-center space-y-6"><div class="grid grid-cols-4 gap-2 text-center text-xs md:text-sm"><div class="p-3 bg-blue-50 rounded-lg border border-blue-100"><div class="text-2xl font-extrabold text-blue-600">${compliant}</div><div class="font-semibold text-blue-800">Đáp ứng đủ</div></div><div class="p-3 bg-amber-50 rounded-lg border border-amber-100"><div class="text-2xl font-extrabold text-amber-600">${partial}</div><div class="font-semibold text-amber-800">Một phần</div></div><div class="p-3 bg-red-50 rounded-lg border border-red-100"><div class="text-2xl font-extrabold text-red-600">${notimpl}</div><div class="font-semibold text-red-800">Chưa đáp ứng</div></div><div class="p-3 bg-slate-100 rounded-lg border border-slate-200"><div class="text-2xl font-extrabold text-slate-600">${na}</div><div class="font-semibold text-slate-700">N/A</div></div></div><div class="p-5 bg-white rounded-xl border-l-4 ${score >= 70 ? 'border-blue-500' : (score >= 40 ? 'border-amber-500' : 'border-red-500')} shadow-sm"><div class="text-sm font-bold text-slate-400 uppercase mb-1">Nhận định sơ bộ</div><div class="text-lg font-bold ${evalColor}">${evalText}</div></div></div></div></div><div class="mb-12"><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center"><span class="bg-blue-600 w-2 h-8 mr-3 rounded-full"></span>2. Biểu đồ Trưởng thành theo Chức năng (NIST Functions)</h2><div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height:400px"><canvas id="domainChart"></canvas></div></div><div class="page-break"></div><div class="mb-12 mt-10"><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center text-red-700"><span class="bg-red-600 w-2 h-8 mr-3 rounded-full"></span>3. Các Điểm yếu Cần khắc phục ngay (Gaps)</h2>${notimpl===0?'<div class="p-5 bg-blue-50 text-blue-700 rounded-xl font-medium border border-blue-200">Tuyệt vời! Không có hạng mục nào "Chưa đáp ứng".</div>':`<table class="w-full text-sm text-left text-slate-700 border-collapse"><thead class="text-xs text-white uppercase bg-red-700"><tr><th class="px-4 py-3 rounded-tl-lg">ID</th><th class="px-4 py-3">Kiểm soát (Subcategory)</th><th class="px-4 py-3 rounded-tr-lg">Hiện trạng & Ghi chú</th></tr></thead><tbody>${auditResults.filter(r=>r.status==="Chưa đáp ứng").map(r=>`<tr class="border-b border-slate-200 bg-red-50/30"><td class="px-4 py-4 font-bold text-red-700 align-top">${r.id}</td><td class="px-4 py-4 font-medium align-top">${r.question}</td><td class="px-4 py-4 text-slate-600 align-top">${r.note||'Chưa có ghi chú.'}</td></tr>`).join('')}</tbody></table>`}</div><div><h2 class="text-2xl font-bold text-slate-800 mb-6 flex items-center"><span class="bg-blue-600 w-2 h-8 mr-3 rounded-full"></span>4. Chi tiết Kết quả Đánh giá</h2><div class="overflow-x-auto rounded-xl border border-slate-200"><table class="w-full text-sm text-left text-slate-700"><thead class="text-xs text-slate-700 uppercase bg-slate-100"><tr><th class="px-4 py-3">ID</th><th class="px-4 py-3">Trạng thái</th><th class="px-4 py-3 w-1/3">Ghi chú</th><th class="px-4 py-3">Bằng chứng</th></tr></thead><tbody class="divide-y divide-slate-200">${auditResults.filter(r=>r.status!=="Bỏ qua").map(r=>`<tr class="bg-white hover:bg-slate-50"><td class="px-4 py-4 font-medium align-top">${r.id}</td><td class="px-4 py-4 align-top"><span class="px-3 py-1 rounded-full text-xs font-bold ${r.status==='Đáp ứng hoàn toàn'?'bg-blue-100 text-blue-800':r.status==='Chưa đáp ứng'?'bg-red-100 text-red-800':r.status==='Đáp ứng một phần'?'bg-amber-100 text-amber-800':'bg-slate-100 text-slate-800'}">${r.status}</span></td><td class="px-4 py-4 align-top text-slate-600 whitespace-pre-wrap">${r.note}</td><td class="px-4 py-4 align-top">${r.evidence_files&&r.evidence_files.length>0?r.evidence_files.map(u=>`<a href="${u}" target="_blank" class="text-blue-600 hover:underline block mb-1 truncate max-w-xs">📎 ${u.split('/').pop()}</a>`).join('<br>'):'<span class="text-slate-400 italic">-</span>'}</td></tr>`).join('')}</tbody></table></div></div></div><div class="fixed bottom-8 right-8 no-print"><button onclick="window.print()" class="bg-blue-600 text-white p-4 rounded-full shadow-xl hover:bg-blue-700 transition flex items-center font-bold"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/></svg>IN BÁO CÁO (PDF)</button></div><script>document.addEventListener('DOMContentLoaded',()=>{new Chart(document.getElementById('domainChart').getContext('2d'),{type:'radar',data:{labels:${JSON.stringify(chartLabels)},datasets:[{label:'Mức độ trưởng thành (%)',data:${JSON.stringify(chartData)},backgroundColor:'rgba(37, 99, 235, 0.2)',borderColor:'rgb(37, 99, 235)',pointBackgroundColor:'rgb(37, 99, 235)',pointBorderColor:'#fff',pointHoverBackgroundColor:'#fff',pointHoverBorderColor:'rgb(37, 99, 235)'}]},options:{responsive:true,maintainAspectRatio:false,scales:{r:{angleLines:{display:true},suggestedMin:0,suggestedMax:100}},plugins:{legend:{position:'top'}}}})});<\/script></body></html>`;
        saveAs(new Blob([reportHTML], { type: "text/html;charset=utf-8" }), `Bao_cao_NIST_CSF_${safeName}_${now.toISOString().slice(0,10)}.html`);
        els.reportFileName.textContent = `Bao_cao_NIST_CSF_${safeName}_${now.toISOString().slice(0,10)}.html`; showScreen('done'); isDirty = false;
    } catch (e) { console.error(e); alert("Lỗi khi tạo báo cáo: " + e.message); }
}

document.addEventListener('DOMContentLoaded', () => {
    els.startButton.addEventListener('click', startAudit);
    els.controlStatus.addEventListener('change', () => { saveCurrentAnswer(); updateProgress(); });
    els.prevButton.addEventListener('click', prevQuestion);
    els.nextButton.addEventListener('click', nextQuestion);
    els.saveReportButton.addEventListener('click', generateReport);
    els.controlEvidenceUpload.addEventListener('change', handleFileUpload);
    els.restartButton.addEventListener('click', () => { els.clientNameInput.value = ""; showScreen('setup'); });
});
</script>
</body>
</html>